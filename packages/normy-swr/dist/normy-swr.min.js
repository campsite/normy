!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("@normy/core"),require("react"),require("swr")):"function"==typeof define&&define.amd?define(["@normy/core","react","swr"],e):"object"==typeof exports?exports.NormySwr=e(require("@normy/core"),require("react"),require("swr")):t.NormySwr=e(t.Normy,t.React,t.Swr)}(self,((t,e,r)=>(()=>{"use strict";var n={700:e=>{e.exports=t},359:t=>{t.exports=e},115:t=>{t.exports=r}},o={};function i(t){var e=o[t];if(void 0!==e)return e.exports;var r=o[t]={exports:{}};return n[t](r,r.exports,i),r.exports}i.d=(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};return(()=>{i.r(a),i.d(a,{SWRNormalizerProvider:()=>p,getId:()=>t.getId,useNormalizedSWRMutation:()=>tt,useSWRNormalizer:()=>y});var t=i(700),e=i(359),r=i(115);function n(t){var e="function"==typeof Map?new Map:void 0;return n=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return o(t,arguments,c(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),u(r,t)},n(t)}function o(t,e,r){return o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct.bind():function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&u(o,r.prototype),o},o.apply(null,arguments)}function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function s(){return s=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},s.apply(this,arguments)}var l=e.createContext(void 0),f=function(t){var e,r;function n(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).normalizer=void 0,e}r=t,(e=n).prototype=Object.create(r.prototype),e.prototype.constructor=e,u(e,r);var o=n.prototype;return o.addNormalizer=function(t){this.normalizer=t},o.set=function(e,r){var n,o,i;return r.data&&(null==(n=null==(o=this.normalizer)||null==o.normalize?void 0:o.normalize(e))||n)&&(null==(i=this.normalizer)||i.setQuery(e,r.data)),t.prototype.set.call(this,e,r)},o.delete=function(e){var r;return null==(r=this.normalizer)||r.removeQuery(e),t.prototype.delete.call(this,e)},n}(n(Map)),d=function(t){var n=t.swrNormalizer,o=t.children,i=(0,r.useSWRConfig)().mutate;return e.useEffect((function(){return n.addMutate(i)}),[]),e.createElement(l.Provider,{value:n},o)},p=function(n){var o=n.normalizerConfig,i=n.swrConfigValue,a=n.children,u=e.useState((function(){return function(e){void 0===e&&(e={});var r=(0,t.createNormalizer)(e),n=null;return s({},r,{addMutate:function(t){n=t},normalize:e.normalize,setNormalizedData:function(t){r.getQueriesToUpdate(t).forEach((function(t){null==n||n(t.queryKey,t.data,{revalidate:!1})}))}})}(o)})),c=u[0],l=e.useState((function(){return function(){var t=new f;return t.addNormalizer(c),t}}))[0];return e.useEffect((function(){return function(){return c.clearNormalizedData()}}),[]),e.createElement(r.SWRConfig,{value:s({},i,{provider:l})},e.createElement(d,{swrNormalizer:c},a))},y=function(){var t=e.useContext(l);if(!t)throw new Error("No SWRNormalizer set, use SWRNormalizerProvider to set one");return t};const v=()=>{},g=v(),m=Object,h=t=>t===g,w=t=>"function"==typeof t,b=(t,e)=>({...t,...e}),O=new WeakMap;let S=0;const E=t=>{const e=typeof t,r=t&&t.constructor,n=r==Date;let o,i;if(m(t)!==t||n||r==RegExp)o=n?t.toJSON():"symbol"==e?t.toString():"string"==e?JSON.stringify(t):""+t;else{if(o=O.get(t),o)return o;if(o=++S+"~",O.set(t,o),r==Array){for(o="@",i=0;i<t.length;i++)o+=E(t[i])+",";O.set(t,o)}if(r==m){o="#";const e=m.keys(t).sort();for(;!h(i=e.pop());)h(t[i])||(o+=i+":"+E(t[i])+",");O.set(t,o)}}return o},R=new WeakMap,_={},z={},j="undefined",C=typeof window!=j,M=typeof document!=j;let x=!0;const[N,P]=C&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[v,v],T={isOnline:()=>x,isVisible:()=>{const t=M&&document.visibilityState;return h(t)||"hidden"!==t}},D={initFocus:t=>(M&&document.addEventListener("visibilitychange",t),N("focus",t),()=>{M&&document.removeEventListener("visibilitychange",t),P("focus",t)}),initReconnect:t=>{const e=()=>{x=!0,t()},r=()=>{x=!1};return N("online",e),N("offline",r),()=>{P("online",e),P("offline",r)}}},W=!e.useId,k=!C||"Deno"in window,q=k?e.useEffect:e.useLayoutEffect,L="undefined"!=typeof navigator&&navigator.connection,I=!k&&L&&(["slow-2g","2g"].includes(L.effectiveType)||L.saveData),Q=t=>{if(w(t))try{t=t()}catch(e){t=""}const e=t;return[t="string"==typeof t?t:(Array.isArray(t)?t.length:t)?E(t):"",e]};let U=0;const V=()=>++U;async function A(...t){const[e,r,n,o]=t,i=b({populateCache:!0,throwOnError:!0},"boolean"==typeof o?{revalidate:o}:o||{});let a=i.populateCache;const u=i.rollbackOnError;let c=i.optimisticData;const s=!1!==i.revalidate,l=i.throwOnError;if(w(r)){const t=r,n=[],o=e.keys();for(const r of o)!/^\$(inf|sub)\$/.test(r)&&t(e.get(r)._k)&&n.push(r);return Promise.all(n.map(f))}return f(r);async function f(r){const[o]=Q(r);if(!o)return;const[i,f]=((t,e)=>{const r=R.get(t);return[()=>!h(e)&&t.get(e)||_,n=>{if(!h(e)){const o=t.get(e);e in z||(z[e]=o),r[5](e,b(o,n),o||_)}},r[6],()=>!h(e)&&e in z?z[e]:!h(e)&&t.get(e)||_]})(e,o),[d,p,y,v]=R.get(e),m=()=>{const t=d[o];return s&&(delete y[o],delete v[o],t&&t[0])?t[0](2).then((()=>i().data)):i().data};if(t.length<3)return m();let O,S=n;const E=V();p[o]=[E,0];const j=!h(c),C=i(),M=C.data,x=C._c,N=h(x)?M:x;if(j&&(c=w(c)?c(N,M):c,f({data:c,_c:N})),w(S))try{S=S(N)}catch(t){O=t}if(S&&w(S.then)){if(S=await S.catch((t=>{O=t})),E!==p[o][0]){if(O)throw O;return S}O&&j&&(t=>"function"==typeof u?u(t):!1!==u)(O)&&(a=!0,f({data:N,_c:g}))}if(a&&!O)if(w(a)){const t=a(S,N);f({data:t,error:g,_c:g})}else f({data:S,error:g,_c:g});if(p[o][1]=V(),Promise.resolve(m()).then((()=>{f({_c:g})})),!O)return S;if(l)throw O}}const F=(t,e)=>{for(const r in t)t[r][0]&&t[r][0](e)},[K,$]=((t,e)=>{if(!R.has(t)){const r=b(D,e),n={},o=A.bind(g,t);let i=v;const a={},u=(t,e)=>{const r=a[t]||[];return a[t]=r,r.push(e),()=>r.splice(r.indexOf(e),1)},c=(e,r,n)=>{t.set(e,r);const o=a[e];if(o)for(const t of o)t(r,n)},s=()=>{if(!R.has(t)&&(R.set(t,[n,{},{},{},o,c,u]),!k)){const e=r.initFocus(setTimeout.bind(g,F.bind(g,n,0))),o=r.initReconnect(setTimeout.bind(g,F.bind(g,n,1)));i=()=>{e&&e(),o&&o(),R.delete(t)}}};return s(),[t,o,s,i]}return[t,R.get(t)[4]]})(new Map),B=(b({onLoadingSlow:v,onSuccess:v,onError:v,onErrorRetry:(t,e,r,n,o)=>{const i=r.errorRetryCount,a=o.retryCount,u=~~((Math.random()+.5)*(1<<(a<8?a:8)))*r.errorRetryInterval;!h(i)&&a>i||setTimeout(n,u,o)},onDiscarded:v,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:I?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:I?5e3:3e3,compare:(t,e)=>E(t)==E(e),isPaused:()=>!1,cache:K,mutate:$,fallback:{}},T),(0,e.createContext)({}),C&&window.__SWR_DEVTOOLS_USE__),J=B?window.__SWR_DEVTOOLS_USE__:[];J.concat((t=>(e,r,n)=>t(e,r&&((...t)=>{const[n]=Q(e),[,,,o]=R.get(K);if(n.startsWith("$inf$"))return r(...t);const i=o[n];return h(i)?r(...t):(delete o[n],i)}),n))),B&&(window.__SWR_DEVTOOLS_REACT__=e);const G=W?t=>{t()}:e.startTransition,H=(X=r,Y=()=>(t,n,o={})=>{const{mutate:i}=(0,r.useSWRConfig)(),a=(0,e.useRef)(t),u=(0,e.useRef)(n),c=(0,e.useRef)(o),s=(0,e.useRef)(0),[l,f,d]=(t=>{const[,r]=(0,e.useState)({}),n=(0,e.useRef)(!1),o=(0,e.useRef)(t),i=(0,e.useRef)({data:!1,error:!1,isValidating:!1}),a=(0,e.useCallback)((t=>{let e=!1;const a=o.current;for(const r in t){const n=r;a[n]!==t[n]&&(a[n]=t[n],i.current[n]&&(e=!0))}e&&!n.current&&r({})}),[]);return q((()=>(n.current=!1,()=>{n.current=!0}))),[o,i.current,a]})({data:g,error:g,isMutating:!1}),p=l.current,y=(0,e.useCallback)((async(t,e)=>{const[r,n]=Q(a.current);if(!u.current)throw new Error("Can’t trigger the mutation: missing fetcher.");if(!r)throw new Error("Can’t trigger the mutation: missing key.");const o=b(b({populateCache:!1,throwOnError:!0},c.current),e),l=V();s.current=l,d({isMutating:!0});try{const e=await i(r,u.current(n,{arg:t}),b(o,{throwOnError:!0}));var f,p;return s.current<=l&&(G((()=>d({data:e,isMutating:!1,error:void 0}))),null==(f=(p=o).onSuccess)||f.call(p,e,r,o)),e}catch(t){var y,v;if(s.current<=l&&(G((()=>d({error:t,isMutating:!1}))),null==(y=(v=o).onError)||y.call(v,t,r,o),o.throwOnError))throw t}}),[]),v=(0,e.useCallback)((()=>{s.current=V(),d({data:g,error:g,isMutating:!1})}),[]);return q((()=>{a.current=t,u.current=n,c.current=o})),{trigger:y,reset:v,get data(){return f.data=!0,p.data},get error(){return f.error=!0,p.error},get isMutating(){return f.isMutating=!0,p.isMutating}}},(...t)=>{const[e,r,n]=(t=>w(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(null===t[1]?t[2]:t[1])||{}])(t),o=(n.use||[]).concat(Y);return X(e,r,{...n,use:o})});var X,Y;function Z(){return Z=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Z.apply(this,arguments)}var tt=function(t,e,n){var o=(0,r.useSWRConfig)().mutate,i=y();return H(t,(function(t,r){return null!=n&&n.optimisticData&&i.getQueriesToUpdate(null==n?void 0:n.optimisticData).forEach((function(t){o(t.queryKey,t.data,{revalidate:!1})})),e(t,r)}),Z({populateCache:!1,revalidate:!1},n,{optimisticData:void 0,onSuccess:function(t,e,r){var a;return(null==(a=null==n?void 0:n.normalize)||a)&&i.getQueriesToUpdate(t).forEach((function(t){o(t.queryKey,t.data,{revalidate:!1})})),null==n||null==n.onSuccess?void 0:n.onSuccess(t,e,r)},onError:function(t,e,r){return null!=n&&n.rollbackData&&i.getQueriesToUpdate(null==n?void 0:n.rollbackData).forEach((function(t){o(t.queryKey,t.data,{revalidate:!1})})),null==n||null==n.onError?void 0:n.onError(t,e,r)}}))}})(),a})()));
//# sourceMappingURL=normy-swr.min.js.map